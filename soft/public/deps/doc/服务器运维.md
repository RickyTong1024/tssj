# 服务器运维

## 开服

开服直接采用源代码部署到目标机器。然后在目标机器上编译和链接。部署的过程采用web的形式。整个流程如下：

1. 在部署web（gttool)服务器上新建一个文件夹deploy

2. 开发环境打包源代码

   进入工程的public文件夹，修改deploy.py文件中的配置：

```python
api.env.hosts = ["xxx"] # web服务器地址
api.env.project_dev_root = "E:\\zhanliang\\soft\\public" # public文件夹地址
api.env.project_tar_root = "E:\\zhanliang\\soft\\public\\version" # public文件夹下version文件夹的地址
api.env.deploy_project_root = "/root/app" # web服上deploy文件夹所在目录,形如/root/app/deploy
```

3. 运行public文件夹下的deploy.bat批处理,打包的过程中会提示输入：

   1. version ID 这个是版本号ID，可以随便填一个数字，每次打包不同即可
   2. pt 这个是平台，比如填changwei,表示是长尾渠道打的包
   3. libao server url 这个是礼包服务的外网IP地址 (参见服务器部署礼包服)
   4. pvp server url 这个是跨服pvp外网IP地址(参见服务器部署pvp服)

4. 正常打包结束就会在web服务器的deploy目录中生成形如/root/app/deploy/pt/versionID/work目录，其中work目录中就是用于开服的源代码和配置表

5. 将数据库表命名为tsjh.sql（这里面只有表结构）拖放到/root/app/deploy/pt/versionID/目录中，这个表结构模板将用于生成开服的数据库

6. 到web后台的Server lists中填写开服配置：(具体参考服务器中gttool部署)

   | 当前版本       | 填写打包配置的versionID  |
   | -------------- | ------------------------ |
   | 部署源代码路径 | 形如/root/app/deploy/pt/ |

7. 以上配置完成，就可以在后台服务器时间中部署开服服务器和测试

#### 注意事项

1. 在更新服务器的过程中，如果配置表和源代码，common中的protocol和数据库结构有修改过，则记得deploy文件夹中的相应东西也需要更新或者可以重新打包一个新版本（版本号不同），不然部署新服会有问题（如果新服以前提前配置了，那需要更新新服相应的东西）



2. 自动开服结束后，会收到一封邮件，如果开服成功，会收到成功邮件，失败会收到失败邮件。失败的邮件要特别关注，第一时间处理。

   126邮箱 查看oss同步情况
   username :xiaobang29@126.com
   passworld :45630066CCdd

